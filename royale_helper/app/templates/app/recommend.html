{% extends 'app/base.html' %}

{% block body_class %}page-decks{% endblock %}

{% block content %}
<div class="recommend-page">
    <div class="recommend-hero-card">
        <div class="recommend-hero-header">
            <h2>–ü–æ–¥–±–æ—Ä –∫–æ–ª–æ–¥—ã –ø–æ —Ç–µ–≥—É –∏–≥—Ä–æ–∫–∞</h2>
            <p>–í–≤–µ–¥–∏ —Å–≤–æ–π —Ç–µ–≥ –∏–∑ Clash Royale, –∏ –º—ã –ø–æ–¥–±–µ—Ä—ë–º –∫–æ–ª–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥—è—Ç –ø–æ–¥ —Ç–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç.</p>
        </div>

        <form method="post" class="recommend-form">
            {% csrf_token %}
            <label for="player_tag" class="field-label">–¢–µ–≥ –∏–≥—Ä–æ–∫–∞ Clash Royale</label>
            <div class="recommend-form-row">
                <input type="text"
                       id="player_tag"
                       name="player_tag"
                       value="{{ player_tag|default_if_none:'' }}"
                       class="input-clash"
                       placeholder="#ABC123XYZ">
                <button type="submit" class="btn-clash">–ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–æ–ª–æ–¥—ã</button>
            </div>
            <p class="field-hint">–°–∫–æ–ø–∏—Ä—É–π —Ç–µ–≥ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è Clash Royale. –°–∏–º–≤–æ–ª # –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å.</p>
        </form>

        {% if error %}
            <div class="alert alert-error">
                {{ error }}
            </div>
        {% elif info %}
            <div class="alert alert-info">
                {{ info }}
            </div>
        {% endif %}

        {% if player %}
            <div class="player-summary-card">
                <div class="player-summary-main">
                    <div>
                        <div class="player-name">{{ player.name }}</div>
                        <div class="player-tag">{{ player.tag }}</div>
                    </div>
                    <div class="player-level">–£—Ä–æ–≤–µ–Ω—å {{ player.exp_level }}</div>
                </div>
                <div class="player-summary-stats">
                    <div class="player-stat">
                        <span class="player-stat-icon">üèÜ</span>
                        <span class="player-stat-label">–¢—Ä–æ—Ñ–µ–∏</span>
                        <span class="player-stat-value">{{ player.trophies }}</span>
                    </div>
                    {% if player.best_trophies %}
                    <div class="player-stat">
                        <span class="player-stat-icon">‚≠ê</span>
                        <span class="player-stat-label">–õ—É—á—à–∏–π —Å–µ–∑–æ–Ω</span>
                        <span class="player-stat-value">{{ player.best_trophies }}</span>
                    </div>
                    {% endif %}
                    <div class="player-stat">
                        <span class="player-stat-icon">üÉè</span>
                        <span class="player-stat-label">–ö–∞—Ä—Ç</span>
                        <span class="player-stat-value">{{ player.cards|length }}</span>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <div class="recommend-results">
        {% if recommendations %}
            <div class="recommend-results-header">
                <h3>–õ—É—á—à–∏–µ –∫–æ–ª–æ–¥—ã –ø–æ–¥ —Ç–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</h3>
                <p class="recommend-results-subtitle">
                    –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ä—Ç –∏ –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º —É—Ä–æ–≤–Ω—è–º.
                </p>
            </div>

            <div class="decks-grid">
                {% for item in recommendations %}
                <div class="deck-card">
                    <div class="card-images">
                        {% for card_info in item.cards %}
                        <div class="card-wrapper {% if not card_info.level %}card-locked{% endif %}">
                            <img src="{{ card_info.card.icon_url }}"
                                 alt="{{ card_info.card.name }}"
                                 class="card-img"
                                 title="{{ card_info.card.name }}">
                            <span class="card-level-badge {% if not card_info.level %}card-level-badge-locked{% endif %}">
                                {% if card_info.level %}
                                    lvl {{ card_info.effective_level }}
                                {% else %}
                                    –Ω–µ—Ç
                                {% endif %}
                            </span>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="deck-stats deck-stats-extended">
                        <div class="deck-stat-item trophy-stat">
                            <span class="stat-icon">‚úÖ</span>
                            <span class="stat-label">–û—Ç–∫—Ä—ã—Ç–æ</span>
                            <span class="stat-value">{{ item.owned_cards_count }}/8</span>
                        </div>
                        <div class="deck-stat-item">
                            <span class="stat-icon">üíß</span>
                            <span class="stat-label">–≠–ª–∏–∫—Å–∏—Ä</span>
                            <span class="stat-value">{{ item.deck.avg_elixir|default:"-" }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% elif player and not error %}
            <p class="recommend-empty">–î–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–∫–∞ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∫–æ–ª–æ–¥—ã.</p>
        {% else %}
            <p class="recommend-placeholder">
                –í–≤–µ–¥–∏ —Ç–µ–≥ –∏–≥—Ä–æ–∫–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏–∑ –±–∞–∑—ã –º–µ—Ç–æ–≤—ã—Ö –∫–æ–ª–æ–¥.
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}

